!function(m){"use strict";m.appDOM=function(){const r=document.documentElement,l={actionButtons:null,audioCache:new Map},s={debug:!1,focusDelay:200,defaultSoundPath:"media/sound/",maxClassNameLength:50,maxSelectorLength:255,fullscreenConfirmMessage:"Do you want to enter fullscreen mode?",selectors:{actionButtons:"[data-action]"},sound:{preload:!1,volume:1,fadeIn:!1,fadeInDuration:500},classes:{classesToKeep:["hide-page-scrollbar"]}},i={containsSubstring:function(e,t){return e&&t?new RegExp(`\\b${t}\\b`,"i").test(e):(u.warn("Invalid parameters for containsSubstring"),!1)},resetStyle:function(){u.group("Reset Style"),document.querySelectorAll(s.selectors.actionButtons).forEach(e=>{("checkbox"===e.type?(e.checked=!1,e.parentNode):e).classList.remove("active")});var e=r.className.split(" ").filter(e=>s.classes.classesToKeep.includes(e)),e=(r.className=e.join(" "),resetSettings(),r.getAttribute("data-bs-theme")||"light");const t="dark"===e;return document.querySelectorAll('[data-action="toggle-theme"]').forEach(e=>{e.setAttribute("aria-pressed",t.toString())}),u.log("Styles reset completed"),u.groupEnd(),i}},c={sanitizeClassName:function(e){var t;return"string"!=typeof e?(u.error("Invalid class name type"),""):e.length>s.maxClassNameLength?(u.error(`Class name exceeds maximum length of ${s.maxClassNameLength} characters`),""):((t=e.replace(/[^a-zA-Z0-9-_]/g,"").replace(/^[0-9-_]/,"").substring(0,s.maxClassNameLength))!==e&&u.warn(`Class name "${e}" contained invalid characters and was sanitized to "${t}"`),t)},sanitizeSelector:function(e){return"string"!=typeof e?(u.error("Invalid selector type"),""):e.length>s.maxSelectorLength?(u.error(`Selector exceeds maximum length of ${s.maxSelectorLength} characters`),""):/<[^>]*>|javascript:|data:|@import|expression|url\(|eval\(|setTimeout|setInterval/i.test(e)?(u.error("Potential malicious selector detected"),""):e.replace(/[<>"'`=\/\\]/g,"").replace(/[\u0000-\u001F\u007F-\u009F]/g,"").trim()},validateDataAttribute:function(e){return"string"!=typeof e?(u.error("Invalid data attribute type"),""):e.length>s.maxClassNameLength?(u.error(`Data attribute exceeds maximum length of ${s.maxClassNameLength} characters`),""):e.replace(/[^a-zA-Z0-9-_]/g,"").substring(0,s.maxClassNameLength)},checkFullscreenPermission:function(){if(!(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled))return u.error("Fullscreen not supported in this browser"),!1;if(m.self!==m.top)try{if(!m.parent.document.fullscreenEnabled)return u.error("Fullscreen not allowed in iframe"),!1}catch(e){return u.error("Cannot access parent frame for fullscreen permission"),!1}return!0},getClosestElement:function(e,t){if(!e||!t)return u.error("Invalid parameters for getClosestElement"),null;try{return e.closest(t)}catch(e){return u.error("Error finding closest element: "+e.message),null}}},u={log:function(e){s.debug&&console.log("[SmartAdmin] "+e)},error:function(e){s.debug&&console.error("[SmartAdmin Error] "+e)},warn:function(e){s.debug&&console.warn("[SmartAdmin Warning] "+e)},group:function(e){s.debug&&console.group("[SmartAdmin Group] "+e)},groupEnd:function(){s.debug&&console.groupEnd()}},d={sanitizeFilename:function(e){return e.replace(/[^\w.-]/g,"")},fadeInAudio:async function(t,a,e){t.volume=0;var n=a/20;const o=e/20;for(let e=0;e<=20;e++)await new Promise(e=>setTimeout(e,o)),t.volume=Math.min(a,e*n)},createAudioElement:function(e,t,a){var n=new Audio;return n.src=""+e+t,n.volume=a,n},stopAllSoundsExcept:function(a){l.audioCache.forEach((e,t)=>{t===a||e.paused||(e.pause(),e.currentTime=0,document.querySelectorAll(`[data-audio-playing="${t}"]`).forEach(e=>e.removeAttribute("data-audio-playing")))})}};const e={enter:function(){try{if(document.documentElement.requestFullscreen)return document.documentElement.requestFullscreen();if(document.documentElement.webkitRequestFullscreen)return document.documentElement.webkitRequestFullscreen();if(document.documentElement.mozRequestFullScreen)return document.documentElement.mozRequestFullScreen();if(document.documentElement.msRequestFullscreen)return document.documentElement.msRequestFullscreen();throw new Error("No fullscreen API available")}catch(e){return u.error("Fullscreen error: "+e.message),Promise.reject(e)}},exit:function(){try{if(document.exitFullscreen)return document.exitFullscreen();if(document.webkitExitFullscreen)return document.webkitExitFullscreen();if(document.mozCancelFullScreen)return document.mozCancelFullScreen();if(document.msExitFullscreen)return document.msExitFullscreen();throw new Error("No fullscreen API available")}catch(e){return u.error("Fullscreen exit error: "+e.message),Promise.reject(e)}},isFullscreen:function(){return!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)}},g=(i.checkActiveStyles=function(e,t){u.group("Checking Active Styles");e=r.className.split(" ")||e;return(document.querySelectorAll(s.selectors.actionButtons)||t).forEach(e=>{("checkbox"===e.type?(e.checked=!1,e.parentNode):e).classList.remove("active")}),e.forEach(e=>{e=c.sanitizeClassName(e);document.querySelectorAll(`[data-class="${e}"]`).forEach(e=>{("checkbox"===e.type?(e.checked=!0,e.parentNode):e).classList.add("active")})}),u.groupEnd(),i},{toggle:function(e){var t=e.getAttribute("data-class");if(t){var t=c.sanitizeClassName(t),a=e.getAttribute("data-dependency"),n=e.getAttribute("data-codependence"),e=e.getAttribute("data-focus");if(u.group("Toggle Action"),u.log("Toggling class: "+t),r.classList.toggle(t),a&&a.split(" ").forEach(e=>{e=c.sanitizeClassName(e);r.classList.add(e),u.log("Added dependency class: "+e)}),n&&n.split(" ").forEach(e=>{e=c.sanitizeClassName(e);r.classList.remove(e),u.log("Removed codependency class: "+e)}),e){const o=c.validateDataAttribute(e);setTimeout(()=>{var e=document.getElementById(o);e&&e.focus(),u.log("Focus set to element: "+o)},s.focusDelay)}"function"==typeof m.saveSettings&&(m.saveSettings(),u.log("ðŸ”‘ Settings saved")),i.checkActiveStyles(),u.groupEnd()}else u.error("Missing required data-class attribute for toggle action")},toggleReplace:function(e){var t=c.sanitizeSelector(e.getAttribute("data-target")),a=c.sanitizeClassName(e.getAttribute("data-removeclass"))||"",e=c.sanitizeClassName(e.getAttribute("data-addclass")),n=document.querySelector(t);u.group("Toggle Replace Action"),n?(n.classList.remove(a),n.classList.add(e),u.log(`Replaced class "${a}" with "${e}" on `+t)):u.error("Target element not found: "+t),u.groupEnd()},toggleSwap:function(e){var t,a=e.getAttribute("data-target"),a=a?c.sanitizeSelector(a):"html",e=c.sanitizeClassName(e.getAttribute("data-toggleclass"));u.group("Toggle Swap Action"),e?(t=document.querySelector(a))?(t.classList.toggle(e),u.log(`Toggled class "${e}" on `+a),i.containsSubstring(a,"drawer")&&(r.classList.toggle("hide-page-scrollbar"),u.log("Toggled page scrollbar"))):u.error("Target element not found: "+a):u.error("Missing required toggleclass attribute for toggle-swap, defaulting to HTML target"),u.groupEnd()},panelActions:{hideTooltips:function(e){e.querySelectorAll('[data-bs-toggle="tooltip"]').forEach(e=>{e=bootstrap.Tooltip.getInstance(e);e&&e.hide()})},collapse:function(e){u.group("Panel Collapse Action");var t,e=c.getClosestElement(e,".panel");if(e){this.hideTooltips(e);const a=e.querySelector(".panel-container");a?(a.style.transition="height 0.35s ease",t=a.scrollHeight,e.classList.contains("panel-collapsed")?(a.style.height="0",a.style.overflow="hidden",a.offsetHeight,e.classList.remove("panel-collapsed"),a.style.height=t+"px",setTimeout(function(){a.style.overflow="visible",a.style.height="auto"},350),u.log("Panel uncollapsed: "+e.id)):(a.style.height=t+"px",a.style.overflow="hidden",a.offsetHeight,e.classList.add("panel-collapsed"),a.style.height="0",u.log("Panel collapsed: "+e.id)),savePanelState()):u.error("Panel container not found")}else u.error("Panel element not found");u.groupEnd()},fullscreen:function(e){u.group("Panel Fullscreen Action");e=c.getClosestElement(e,".panel");e?(this.hideTooltips(e),e.classList.toggle("panel-fullscreen"),document.documentElement.classList.toggle("panel-fullscreen"),u.log("Panel fullscreen toggled: "+e.id)):u.error("Panel element not found"),u.groupEnd()},close:function(t){u.group("Panel Close Action");const a=c.getClosestElement(t,".panel");if(a){this.hideTooltips(a),t=a.querySelector(".panel-hdr h2")?.textContent.trim()||"Untitled Panel";const n=()=>{a.style.transition="opacity 0.5s",a.style.opacity="0",setTimeout(()=>{a.remove(),u.log("Panel removed: "+a.id)},500)};let e=document.getElementById("panelDeleteModal");e||(document.body.insertAdjacentHTML("beforeend",`
                            <div class="modal fade" id="panelDeleteModal" tabindex="-1" aria-hidden="true" style="--bs-modal-width: 450px;">
                                <div class="modal-dialog modal-dialog-centered">
                                    <div class="modal-content bg-dark bg-opacity-50 shadow-5 translucent-dark">
                                        <div class="modal-header border-bottom-0">
                                            <h4 class="modal-title text-white d-flex align-items-center">
                                                Delete Panel?
                                            </h4>
                                            <button type="button" class="btn btn-system btn-system-light ms-auto" data-bs-dismiss="modal" aria-label="Close">
                                                <svg class="sa-icon sa-icon-2x">
                                                    <use href="img/sprite.svg#x"></use>
                                                </svg>
                                            </button>
                                        </div>
                                        <div class="modal-body"></div>
                                        <div class="modal-footer border-top-0">
                                            <button type="button" class="btn btn-light" data-bs-dismiss="modal">No, cancel</button>
                                            <button type="button" class="btn btn-danger" id="confirmPanelDelete">Yes, delete</button>
                                        </div>
                                    </div>
                                </div>
                            </div>`),e=document.getElementById("panelDeleteModal")),e.querySelector(".modal-body").innerHTML=`
                    <div class="alert alert-danger bg-danger border-danger text-danger border-opacity-50 bg-opacity-10 mb-0">
                        You are about to delete <span class="fw-700">${t}.</span>
                        Are you sure you want to delete this panel?
                    </div>`;const o=new bootstrap.Modal(e),r=e.querySelector("#confirmPanelDelete"),l=()=>{n(),o.hide(),r.removeEventListener("click",l)};r.addEventListener("click",l),o.show(),e.addEventListener("hidden.bs.modal",()=>{r.removeEventListener("click",l)},{once:!0})}else u.error("Panel element not found");u.groupEnd()},style:function(e){u.group("Panel Style Action");var t=c.getClosestElement(e,".panel");if(t){const a=t.querySelector(".panel-hdr");a?(t=e.getAttribute("data-panel-style"))?0===(e=t.split(" ").map(e=>c.sanitizeClassName(e.trim())).filter(e=>e.startsWith("bg-"))).length?u.error("No valid bg-* classes specified"):(Array.from(a.classList).filter(e=>e.startsWith("bg-")).forEach(e=>{a.classList.remove(e)}),e.forEach(e=>{a.classList.add(e),u.log("Added panel style: "+e)}),savePanelState()):u.error("No style classes specified"):u.error("Panel header not found")}else u.error("Panel element not found");u.groupEnd()},toggleClass:function(e){u.group("Panel Toggle Class Action");var t=c.getClosestElement(e,".panel");t?(e=c.sanitizeClassName(e.getAttribute("data-panel-toggle")))?(t.classList.toggle(e),u.log("Panel class toggled: "+e),savePanelState()):u.error("No toggle class specified"):u.error("Panel element not found"),u.groupEnd()},reset:function(e){u.group("Panel Reset Action");const t=c.getClosestElement(e,".panel");if(t){e=Array.from(t.classList);const a=t.querySelector(".panel-hdr");e.forEach(e=>{["panel","panel-collapsed","panel-fullscreen"].includes(e)||t.classList.remove(e)}),a&&Array.from(a.classList).forEach(e=>{"panel-hdr"!==e&&a.classList.remove(e)}),u.log("Panel reset to default state"),savePanelState()}else u.error("Panel element not found");u.groupEnd()},refresh:function(e){u.group("Panel Refresh Action");const t=c.getClosestElement(e,".panel");if(t){var a=parseInt(e.getAttribute("data-refresh-duration"))||1e3;if(t.classList.contains("panel-refreshing"))u.warn("Panel is already refreshing");else{t.classList.add("panel-refreshing"),u.log("Panel refresh started");e=e.getAttribute("data-refresh-callback");if(e&&"function"==typeof m[e])try{m[e](t),u.log("Executed callback: "+e)}catch(e){u.error("Error in refresh callback: "+e.message)}setTimeout(()=>{t.classList.remove("panel-refreshing"),u.log("Panel refresh completed")},a)}}else u.error("Panel element not found");u.groupEnd()}},toggleTheme:function(){u.group("Toggle Theme Action");var e="light"===(r.getAttribute("data-bs-theme")||"light")?"dark":"light";r.setAttribute("data-bs-theme",e),u.log("Theme switched to: "+e),i.updateThemeButtonsState(),"function"==typeof m.saveSettings&&(m.saveSettings(),u.log("Theme settings saved")),u.groupEnd()},removeClass:function(e){var t=c.sanitizeSelector(e.getAttribute("data-target")),e=c.sanitizeClassName(e.getAttribute("data-classname")),a=document.querySelector(t);u.group("Remove Class Action"),a?.classList.contains(e)&&(a.classList.remove(e),u.log(`Removed class "${e}" from `+t)),"html"===t&&"function"==typeof m.saveSettings&&(m.saveSettings(),i.checkActiveStyles(),u.log("Settings saved")),u.groupEnd()},addClass:function(e){var t=c.sanitizeSelector(e.getAttribute("data-target")),e=c.sanitizeClassName(e.getAttribute("data-classname")),a=document.querySelector(t);u.group("Add Class Action"),a?(a.classList.add(e),u.log(`Added class "${e}" to `+t)):u.error("Target element not found: "+t),"html"===t&&"function"==typeof m.saveSettings&&(m.saveSettings(),i.checkActiveStyles(),u.log("Settings saved")),u.groupEnd()},appFullscreen:function(){u.group("Fullscreen Action"),c.checkFullscreenPermission()?e.isFullscreen()?e.exit().then(()=>u.log("Exited fullscreen mode")).catch(e=>u.error("Fullscreen exit error: "+e.message)):m.confirm(s.fullscreenConfirmMessage)&&e.enter().then(()=>u.log("Entered fullscreen mode")).catch(e=>u.error("Fullscreen error: "+e.message)):u.error("Fullscreen permission denied"),u.groupEnd()},playSound:async function(n){return;/*u.group("Play Sound Action");try{var e=n.getAttribute("data-soundfile");if(!e)throw new Error("No sound file specified");var t=d.sanitizeFilename(e);if(n.getAttribute("data-audio-playing")!==t){d.stopAllSoundsExcept(t);var o=s.defaultSoundPath;let a=l.audioCache.get(t);return a||(a=d.createAudioElement(o,t,s.sound.volume),l.audioCache.set(t,a)),a.currentTime=0,s.sound.fadeIn&&await d.fadeInAudio(a,s.sound.volume,s.sound.fadeInDuration),await a.play(),n.setAttribute("data-audio-playing",t),u.log("Playing sound: "+o+t),new Promise((e,t)=>{a.addEventListener("ended",()=>{n.removeAttribute("data-audio-playing"),e()},{once:!0}),a.addEventListener("error",e=>t(e),{once:!0})})}g.pauseSound(n)}catch(e){throw u.error("Failed to play sound: "+e.message),e}finally{u.groupEnd()} */},pauseSound:function(e){u.group("Pause Sound Action");try{var t,a=e.getAttribute("data-audio-playing");a?(t=l.audioCache.get(a))&&(t.pause(),t.currentTime=0,e.removeAttribute("data-audio-playing"),u.log("Paused sound: "+a)):u.log("No sound currently playing")}catch(e){u.error("Failed to pause sound: "+e.message)}finally{u.groupEnd()}}});function t(e){const t=e.target.closest(s.selectors.actionButtons);var a;t&&((a={toggle:()=>g.toggle(t),"toggle-replace":()=>g.toggleReplace(t),"toggle-swap":()=>g.toggleSwap(t),"remove-class":()=>g.removeClass(t),"add-class":()=>g.addClass(t),"app-fullscreen":()=>g.appFullscreen(),playsound:()=>g.playSound(t),pausesound:()=>g.pauseSound(t),"panel-collapse":()=>g.panelActions.collapse(t),"panel-fullscreen":()=>g.panelActions.fullscreen(t),"panel-close":()=>g.panelActions.close(t),"panel-style":()=>g.panelActions.style(t),"panel-toggle":()=>g.panelActions.toggleClass(t),"panel-reset":()=>g.panelActions.reset(t),"panel-refresh":()=>g.panelActions.refresh(t),"toggle-theme":()=>g.toggleTheme()}[e=c.validateDataAttribute(t.dataset.action)])?(a(),u.log("Action executed: "+e)):u.warn("Unknown action type: "+e))}return i.preloadSound=function(e){var t,e=d.sanitizeFilename(e);return l.audioCache.has(e)||(t=d.createAudioElement(s.defaultSoundPath,e,s.sound.volume),l.audioCache.set(e,t)),i},i.config=function(e){return Object.assign(s,e),u.log("Configuration updated"),i},i.debug=function(e){var t="app-debug-mode";return(s.debug=e)?document.body.classList.add(t):document.body.classList.remove(t),u.log("Debug mode "+(e?"enabled":"disabled")),i},i.toggleTheme=function(){return g.toggleTheme(),i},i.updateThemeButtonsState=function(){const t="dark"===(r.getAttribute("data-bs-theme")||"light");return document.querySelectorAll('[data-action="toggle-theme"]').forEach(e=>{e.setAttribute("aria-pressed",t.toString()),u.log(`Updated aria-pressed to ${t} on theme toggle button`)}),i},i.toggleClass=function(e,t){var a;return e&&t?((a=document.createElement("button")).setAttribute("data-action","toggle"),a.setAttribute("data-class",t),a.setAttribute("data-target",e),g.toggle(a)):u.error("Target and className are required for toggleClass"),i},i.toggleReplace=function(e,t,a){var n;return e&&a?((n=document.createElement("button")).setAttribute("data-action","toggle-replace"),n.setAttribute("data-target",e),n.setAttribute("data-addclass",a),t&&n.setAttribute("data-removeclass",t),g.toggleReplace(n)):u.error("Target and addClass are required for toggleReplace"),i},i.toggleSwap=function(e,t){var a;return e&&t?((a=document.createElement("button")).setAttribute("data-action","toggle-swap"),a.setAttribute("data-target",e),a.setAttribute("data-toggleclass",t),g.toggleSwap(a)):u.error("Target and toggleClass are required for toggleSwap"),i},i.destroy=function(){document.removeEventListener("click",t),l.actionButtons=null,l.audioCache.forEach(e=>{e.pause(),e.src=""}),l.audioCache.clear(),u.log("Plugin destroyed")},document.addEventListener("click",t),document.addEventListener("DOMContentLoaded",function(){l.actionButtons=document.querySelectorAll(s.selectors.actionButtons),i.checkActiveStyles();const t="dark"===(r.getAttribute("data-bs-theme")||"light");document.querySelectorAll('[data-action="toggle-theme"]').forEach(e=>{e.setAttribute("aria-pressed",t.toString())}),u.log("Plugin initialized")}),setTimeout(()=>{const t="dark"===(r.getAttribute("data-bs-theme")||"light");document.querySelectorAll('[data-action="toggle-theme"]').forEach(e=>{e.setAttribute("aria-pressed",t.toString())})},0),i}()}(window);